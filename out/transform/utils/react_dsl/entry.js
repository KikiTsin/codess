"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var l=Object.getOwnPropertyDescriptor(t,s);l&&!("get"in l?!t.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,l)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(null!=s)for(var l in s)"default"!==l&&Object.prototype.hasOwnProperty.call(s,l)&&e(n,s,l);return t(n,s),n},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const l=require("./utils"),o=require("./consts"),a=s(require("lodash")),i=n(require("./exportBlock")),c=n(require("./exportCreateApp")),r=n(require("./exportGlobalCss"));async function p(e,t){const s=[],n=[];t.scale=750/(t.responsive&&t.responsive.width||750),t.componentsMap=(0,l.transComponentsMap)(t.componentsMap),t.blockInPage="Page"===e.componentName,t.pageGlobalCss=e.css||"";const p=Object.assign({scale:t.scale,globalCss:!0,cssUnit:"px",inlineStyle:o.CSS_TYPE.MODULE_CLASS,componentStyle:o.COMPONENT_TYPE.HOOKS,htmlFontSize:16},a.get(e,"imgcook.dslConfig"));p.useHooks=p.componentStyle===o.COMPONENT_TYPE.HOOKS,p.useTypescript="typescript"===p.jsx,t.dslConfig=p,e.css=e.css||(t.useTailwind?"":o.defaultGlobalCss),(0,o.initConfig)(p);const{inlineStyle:u}=p;(0,l.initSchema)(e);const f=p.outputStyle==o.OUTPUT_TYPE.PROJECT;f&&(e.componentName="Page"),(0,l.traverse)(e,(e=>{switch(e.componentName.toLowerCase()){case"block":s.push(e);break;case"page":n.push(e)}})),[o.CSS_TYPE.IMPORT_CLASS].includes(u)&&(0,l.traverse)(e,(t=>{let s=t.classnames||[],n=t.props.style;if(p.globalCss&&e.css){const o=(0,l.getGlobalClassNames)(n,e.css);o.names.length>0&&(s=[...s,...o.names]),t.props.style=o.style,t.classnames=s||[]}})),[o.CSS_TYPE.IMPORT_CLASS,o.CSS_TYPE.MODULE_CLASS].includes(u)&&s.forEach((e=>{(0,l.commonStyle)(e)})),(0,l.simpleStyle)(e),t.useTailwind&&(0,l.tailwindStyle)(e),(0,l.traverse)(e,(e=>{let t=e.classnames||[],s=e.tailwindClassnames||[];const n=e.props&&e.props.className||"";let a="";const i=e.props.style;if(u===o.CSS_TYPE.INLINE_CSS)n&&(a=`className="${n}"`),e.props.codeStyle=i;else if(u===o.CSS_TYPE.MODULE_STYLE)n&&(a=` style={${(0,l.genStyleCode)("styles",n)}}`);else if(u==o.CSS_TYPE.MODULE_CLASS)if(t.push(n),t=t.filter((e=>""!==e)),t=t.map((e=>(0,l.genStyleCode)("styles",e))),t.length>1||s.length>0){let e=t.length>0?"`":"'";a=` className={${e}${t.map((e=>`\${${e}}`)).join(" ").trim()} ${s.join(" ")}${e}}`}else 1==t.length&&(a=` className={${t[0].trim()}}`);else u==o.CSS_TYPE.IMPORT_CLASS&&(t.push(n),t=t.filter((e=>""!==e)),t.length>=1&&(a=` className="${t.join(" ")}"`));e.props.style=i,e.classString=a})),t.blocksCount=s.length,t.pagesCount=n.length;let S=[];if(s.length>0)for(const e of s){const s=await(0,i.default)(e,t);S=S.concat(s)}if("Page"===e.componentName){const s=await(0,i.default)(e,t);S=S.concat(s)}if(f){const s={};for(let e of S)if(e.panelDependencies&&e.panelDependencies.length>0)for(let t of e.panelDependencies)s[t.package]=t.version||"*";S=S.map((e=>(e.folder="src/"+e.folder,e))),S=S.concat(await(0,c.default)(e,{...t,dependencies:s}))}return S=S.concat(await(0,r.default)(e,{...t,folder:f?"src":""})),{panelDisplay:S,noTemplate:!0}}exports.default=p;